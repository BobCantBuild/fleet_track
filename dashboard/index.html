<!DOCTYPE html>
<html>
<head>
  <title>Fleet Track Dashboard</title>
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/12.10.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/12.10.0/firebase-firestore-compat.js"></script>
  <!-- Google Maps -->
  <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&callback=initMap" async defer></script>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;color:#333}
    #header{background:rgba(255,255,255,0.1);backdrop-filter:blur(20px);color:white;padding:2rem;border-radius:0 0 24px 24px;text-align:center;box-shadow:0 8px 32px rgba(0,0,0,0.3)}
    h1{font-size:2.5rem;margin-bottom:0.5rem}
    #tech-list{display:grid;gap:1rem;max-width:1200px;margin:2rem auto;padding:2rem;background:white;border-radius:24px;box-shadow:0 20px 60px rgba(0,0,0,0.2)}
    .tech{padding:1.5rem;border-radius:16px;background:#f8f9fa;border-left:6px solid #4CAF50;position:relative;overflow:hidden;transition:all 0.3s}
    .tech.offline{border-left-color:#f44336;background:#ffebee}
    .tech:hover{transform:translateY(-2px);box-shadow:0 10px 30px rgba(0,0,0,0.2)}
    .status-dot{font-size:1.5rem;margin-right:0.5rem}
    #map{height:600px;width:100%;border-radius:24px;margin-top:2rem;box-shadow:0 20px 60px rgba(0,0,0,0.3)}
    .loading{min-height:200px;display:flex;align-items:center;justify-content:center;color:#666;font-size:1.2rem}
    @media(max-width:768px){#tech-list{margin:1rem;padding:1rem;gap:0.5rem}#map{height:400px}}
  </style>
</head>
<body>
  <div id="header">
    <h1>üöõ Fleet Track Dashboard</h1>
    <p>Live technician locations ‚Ä¢ Trivandrum Division</p>
  </div>
  
  <div id="tech-list" class="loading">Connecting to live data...</div>
  <div id="map"></div>

  <script>
    // YOUR FIREBASE CONFIG
    const firebaseConfig = {
      apiKey: "AIzaSyDb2ro59qZ20XYMCydndpMXgeRJ6HmaEoQ",
      authDomain: "fleet-track-486de.firebaseapp.com",
      projectId: "fleet-track-486de",
      storageBucket: "fleet-track-486de.firebasestorage.app",
      messagingSenderId: "778334362913",
      appId: "1:778334362913:web:a44beb20a97af383043260",
      measurementId: "G-9CR3F7TWJT"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Google Maps
    let map, bounds, markers = {};
    function initMap() {
      map = new google.maps.Map(document.getElementById('map'), {
        zoom: 12,
        center: {lat: 8.6, lng: 76.9}, // Trivandrum
        mapTypeId: 'roadmap',
        styles: [
          {"featureType":"poi","stylers":[{"visibility":"off"}]},
          {"featureType":"transit","stylers":[{"visibility":"off"}]}
        ]
      });
      bounds = new google.maps.LatLngBounds();
    }

    // Live technician tracking
    const techList = document.getElementById('tech-list');
    db.collection('locations').onSnapshot(snapshot => {
      techList.className = '';
      techList.innerHTML = '';
      markers = {}; // Reset markers
      
      let activeCount = 0;
      
      snapshot.forEach(doc => {
        const data = doc.data();
        const isActive = data.status === 'active';
        if (isActive) activeCount++;
        
        // Technician card
        const techDiv = document.createElement('div');
        techDiv.className = `tech ${isActive ? '' : 'offline'}`;
        techDiv.innerHTML = `
          <div>
            <span class="status-dot" style="color:${isActive ? '#4CAF50' : '#f44336'}">‚óè</span>
            <strong>${data.name || 'Unknown Tech'}</strong>
          </div>
          <div style="color:#666;margin:0.25rem 0">${data.franchise || 'No franchise'}</div>
          <div style="font-size:1.1em;margin:0.5rem 0">
            üìç <strong>${data.lat?.toFixed(4) || '?'}¬∞, ${data.lng?.toFixed(4) || '?'}¬∞</strong>
          </div>
          <div style="color:#2196F3;font-weight:600;font-size:1.1em">
            üõ£Ô∏è ${data.totalKm ? data.totalKm.toFixed(1) + ' km' : '0 km'}
          </div>
        `;
        techList.appendChild(techDiv);
        
        // Map marker
        if (data.lat && data.lng) {
          const position = {lat: data.lat, lng: data.lng};
          markers[data.name] = new google.maps.Marker({
            position,
            map,
            title: `${data.name} (${data.totalKm || 0}km)`,
            icon: {
              url: `https://maps.google.com/mapfiles/ms/icons/${isActive ? 'green' : 'red'}-dot.png`,
              scaledSize: new google.maps.Size(32, 32)
            }
          });
          bounds.extend(position);
        }
      });
      
      // Update map bounds
      if (Object.keys(markers).length > 0) {
        map.fitBounds(bounds);
      } else {
        techList.innerHTML = `
          <div style="text-align:center;padding:3rem;color:#666">
            <div style="font-size:3rem;margin-bottom:1rem">üöõ</div>
            <div>No technicians active</div>
            <div style="font-size:0.9rem;margin-top:0.5rem">Punch IN to see live tracking</div>
          </div>
        `;
      }
      
      // Header count
      document.querySelector('#header p').innerHTML = 
        `Live tracking ‚Ä¢ ${activeCount} active`;
    });
  </script>
</body>
</html>
